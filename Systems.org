#+TITLE: System Settings
#+PROPERTY: header-args    :tangle-mode (identity #o444)
#+PROPERTY: header-args:sh :tangle-mode (identity #o555)

* Utility Scripts

** Update Emacs Config

#+begin_src sh :tangle update-emacs-config :shebang #!/bin/sh

# The heavy lifting is done by an Emacs script
emacs -Q --script ~/.emacs.d/tangle-emacs-config.el

#+end_src

** Tangle Org files

#+begin_src emacs-lisp :tangle tangle-emacs-config.el

  (require 'org)

  ;; Don't ask when evaluating code blocks
  (setq org-confirm-babel-evaluate nil)

  (let* ((dotfiles-path (expand-file-name "."))
         (org-files (directory-files dotfiles-path nil "\\.org$")))

    (defun dn/tangle-org-file (org-file)
      (message "\n\033[1;32mUpdating %s\033[0m\n" org-file)
      (org-babel-tangle-file (expand-file-name org-file dotfiles-path)))

    ;; Tangle Systems.org first
    (dn/tangle-org-file "Systems.org")

    (dolist (org-file org-files)
      (unless (member org-file '("README.org" "Systems.org"))
        (dn/tangle-org-file org-file))))

#+end_src
